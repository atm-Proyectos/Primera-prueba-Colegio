<div class="dashboard-panel">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>ğŸ“š GestiÃ³n de Asignaturas</h2>
        <div *ngIf="!api.soyAlumno()" style="display: flex; gap: 10px;">
            <button class="btn-nuevo" (click)="abrirModalCrear()">â• AÃ±adir Asignatura</button>
            <button *ngIf="api.soyAdmin()" class="btn-profesor" (click)="abrirModalNuevoProfesor()">ğŸ‘¨â€ğŸ« Nuevo
                Profesor</button>
        </div>
    </div>

    <div *ngIf="(cargando$ | async)" class="loading-container">
        <div class="spinner"></div>
        <p>Cargando datos...</p>
    </div>

    <table class="tabla-datos" *ngIf="!(cargando$ | async)">
        <thead>
            <tr>
                <th>Asignatura</th>
                <th>Profesor</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let asig of asignaturas$ | async">
                <td>{{ asig.Clase }}</td>
                <td>{{ asig.Profesor || '---' }}</td>
                <td style="text-align: center;">
                    <ng-container *ngIf="api.soyAdmin() || api.soyProfesor()">
                        <button (click)="editar(asig)" class="btn-editar" title="Editar">âœï¸</button>
                        <button *ngIf="api.soyAdmin()" (click)="eliminar(asig.Id)" class="btn-borrar"
                            title="Borrar">ğŸ—‘ï¸</button>
                    </ng-container>
                    <ng-container *ngIf="api.soyAlumno()">
                        <button *ngIf="!asig.MatriculaId" (click)="matricularse(asig)" class="btn-nuevo">â•
                            Matricularme</button>
                        <button *ngIf="asig.MatriculaId" (click)="desmatricularse(asig)" class="btn-borrar">âŒ Dejar
                            Asignatura</button>
                    </ng-container>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="modal-overlay" *ngIf="mostrarModal">
        <div class="modal-content animate-fade-in">
            <h3>{{ formAsignatura.Id === 0 ? 'Nueva Asignatura' : 'Editar Asignatura' }}</h3>
            <form (ngSubmit)="guardar()">
                <label class="label-form">Nombre de la Clase:</label>
                <input type="text" [(ngModel)]="formAsignatura.Clase" name="clase" class="input-form" required>

                <label class="label-form">Profesor:</label>
                <select [(ngModel)]="formAsignatura.Profesor" name="profesor" class="input-form" required>
                    <option value="">-- Sin asignar --</option>
                    <option *ngFor="let prof of listaProfesores" [value]="prof.nombre">
                        {{ prof.nombre }}
                    </option>
                </select>

                <div class="botones-modal">
                    <button type="button" (click)="cerrarModal()" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-guardar">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" *ngIf="mostrarModalProfesor">
        <div class="modal-content animate-fade-in" style="border-top: 5px solid #8e44ad;">
            <h3>ğŸ‘¨â€ğŸ« Nuevo Profesor y Asignatura</h3>
            <p class="text-muted" style="font-size: 0.9em;">Se generarÃ¡ usuario y contraseÃ±a automÃ¡ticamente.</p>

            <form (ngSubmit)="crearProfesorYAsignatura()">
                <label class="label-form">Nombre del Profesor:</label>
                <input type="text" [(ngModel)]="formProfesor.Nombre" name="nombreProf" class="input-form"
                    placeholder="Ej: Juan PÃ©rez" required>

                <label class="label-form">Asignatura a impartir:</label>
                <input type="text" [(ngModel)]="formProfesor.AsignaturaInicial" name="asigInicial" class="input-form"
                    placeholder="Ej: FÃ­sica CuÃ¡ntica" required>

                <div class="botones-modal">
                    <button type="button" (click)="cerrarModalProfesor()" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-guardar" style="background-color: #8e44ad;">Crear Todo</button>
                </div>
            </form>
        </div>
    </div>

</div>