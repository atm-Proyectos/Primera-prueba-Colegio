<div class="dashboard-panel">
    <h2>ğŸ“š GestiÃ³n de Asignaturas</h2>

    <div *ngIf="mensajeError" class="alerta-error">
        {{ mensajeError }}
    </div>

    <form *ngIf="!api.soyAlumno()" #formAsig="ngForm" (ngSubmit)="guardar()">
        <div class="filtros-dashboard" style="align-items: flex-start;">
            <div style="flex: 1;">
                <input type="text" [(ngModel)]="formAsignatura.clase" name="clase" required maxlength="100"
                    minlength="2" pattern="^[a-zA-ZÃ±Ã‘Ã¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“Ãš\s\.-]+$" placeholder="Nombre Asignatura (Ej. Mates)"
                    #clase="ngModel" [class.input-error]="clase.invalid && (clase.dirty || clase.touched)"
                    style="width: 100%;">

                <small *ngIf="clase.invalid && (clase.dirty || clase.touched)" class="msg-error">
                    <div *ngIf="clase.errors?.['required']">El nombre es obligatorio.</div>
                    <div *ngIf="clase.errors?.['minlength']">MÃ­nimo 2 letras.</div>
                    <div *ngIf="clase.errors?.['pattern']">Solo letras, puntos (.) o guiones (-).</div>
                </small>
            </div>

            <div style="flex: 1;">
                <input type="text" [(ngModel)]="formAsignatura.profesor" name="profesor" required maxlength="50"
                    minlength="3" pattern="^[a-zA-ZÃ±Ã‘Ã¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“Ãš\s\.-]+$" placeholder="Profesor Asignado"
                    #profesor="ngModel" [class.input-error]="profesor.invalid && (profesor.dirty || profesor.touched)"
                    style="width: 100%;">

                <small *ngIf="profesor.invalid && (profesor.dirty || profesor.touched)" class="msg-error">
                    <div *ngIf="profesor.errors?.['required']">El profesor es obligatorio.</div>
                    <div *ngIf="profesor.errors?.['minlength']">MÃ­nimo 3 letras.</div>
                    <div *ngIf="profesor.errors?.['pattern']">Solo letras, puntos (.) o guiones (-).</div>
                </small>
            </div>

            <div style="display: flex; gap: 5px;">
                <button type="submit" class="btn-guardar" [disabled]="formAsig.invalid || (cargando$ | async)"
                    [title]="formAsig.invalid ? 'Corrige los campos en rojo' : 'Guardar'">
                    {{ formAsignatura.id === 0 ? 'ğŸ’¾ Crear' : 'ğŸ”„ Actualizar' }}
                </button>

                <button *ngIf="formAsignatura.id !== 0" type="button" (click)="limpiar()"
                    class="btn-cancelar">âŒ</button>
            </div>
        </div>
    </form>

    <div *ngIf="(cargando$ | async)" class="loading-container">
        <div class="spinner"></div>
        <p>Cargando asignaturas...</p>
    </div>

    <table class="tabla-datos" *ngIf="!(cargando$ | async)">
        <thead>
            <tr>
                <th>Asignatura</th>
                <th>Profesor</th>
                <th *ngIf="!api.soyAlumno()">Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let asig of asignaturas$ | async">
                <td>{{ asig.clase }}</td>
                <td>{{ asig.profesor || '---' }}</td>
                <td *ngIf="!api.soyAlumno()">
                    <button (click)="editar(asig)" class="btn-editar">âœï¸</button>
                    <button (click)="eliminar(asig.id)" class="btn-borrar">ğŸ—‘ï¸</button>
                </td>
            </tr>
            <tr *ngIf="(asignaturas$ | async)?.length === 0">
                <td colspan="3" style="text-align:center; padding: 20px; color: #777;">
                    No hay asignaturas creadas.
                </td>
            </tr>
        </tbody>
    </table>
</div>