<div class="dashboard-panel">

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>ğŸ“š GestiÃ³n de Asignaturas</h2>

        <div *ngIf="!api.soyAlumno()" style="display: flex; gap: 10px;">
            <button class="btn-nuevo" (click)="abrirModalCrear()">
                â• AÃ±adir Asignatura
            </button>

            <button *ngIf="api.soyAdmin()" class="btn-nuevo" style="background-color: #6f42c1;"
                (click)="abrirModalNuevoProfesor()">
                ğŸ‘¨â€ğŸ« Nuevo Profesor
            </button>
        </div>
    </div>

    <div *ngIf="(cargando$ | async)" class="loading-container">
        <div class="spinner"></div>
        <p>Cargando datos...</p>
    </div>

    <table class="tabla-datos" *ngIf="!(cargando$ | async)">
        <thead>
            <tr>
                <th>Asignatura</th>
                <th>Profesor</th>
                <th *ngIf="!api.soyAlumno()">Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let asig of asignaturas$ | async">
                <td>{{ asig.clase }}</td>
                <td>{{ asig.profesor || '---' }}</td>
                <td *ngIf="!api.soyAlumno()" style="text-align: center;">
                    <button (click)="editar(asig)" class="btn-editar">âœï¸</button>
                    <button *ngIf="api.soyAdmin()" (click)="eliminar(asig.id)" class="btn-borrar">ğŸ—‘ï¸</button>
                </td>
            </tr>
            <tr *ngIf="(asignaturas$ | async)?.length === 0">
                <td colspan="3" style="text-align: center; padding: 20px;">No hay asignaturas registradas.</td>
            </tr>
        </tbody>
    </table>

    <div class="modal-overlay" *ngIf="mostrarModal">
        <div class="modal-content animate-fade-in">
            <h3>{{ formAsignatura.id === 0 ? 'Nueva Asignatura' : 'Editar Asignatura' }}</h3>

            <form (ngSubmit)="guardar()">
                <label>Nombre de la Clase:</label>
                <input type="text" [(ngModel)]="formAsignatura.clase" name="clase" class="input-form"
                    placeholder="Ej: MatemÃ¡ticas" required>

                <label *ngIf="api.soyAdmin()">Profesor:</label>
                <select *ngIf="api.soyAdmin()" [(ngModel)]="formAsignatura.profesor" name="profesor" class="input-form">
                    <option value="">-- Selecciona --</option>
                    <option *ngFor="let prof of listaProfesores"
                        [value]="prof.usuario || prof.nombreUsuario || prof.nombre">
                        {{ prof.nombre }} {{ prof.apellido }} ({{ prof.usuario || prof.nombreUsuario }})
                    </option>
                </select>

                <div class="botones-modal">
                    <button type="button" (click)="cerrarModal()" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-guardar">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" *ngIf="mostrarModalProfesor">
        <div class="modal-content animate-fade-in" style="border-top: 5px solid #6f42c1;">
            <h3>ğŸ‘¨â€ğŸ« Nuevo Profesor y Asignatura</h3>
            <p class="text-muted" style="font-size: 0.9em;">Se generarÃ¡ usuario y contraseÃ±a automÃ¡ticamente.</p>

            <form (ngSubmit)="crearProfesorYAsignatura()">
                <label>Nombre del Profesor:</label>
                <input type="text" [(ngModel)]="formProfesor.nombre" name="nombreProf" class="input-form"
                    placeholder="Ej: Juan PÃ©rez" required>

                <label>Asignatura a impartir:</label>
                <input type="text" [(ngModel)]="formProfesor.asignaturaInicial" name="asigInicial" class="input-form"
                    placeholder="Ej: FÃ­sica CuÃ¡ntica" required>

                <div class="botones-modal">
                    <button type="button" (click)="cerrarModalProfesor()" class="btn-cancelar">Cancelar</button>
                    <button type="submit" class="btn-guardar" style="background-color: #6f42c1;">Crear Todo</button>
                </div>
            </form>
        </div>
    </div>

</div>