<div class="dashboard-panel">
    <h2>ğŸ“ Mi Perfil: {{ nombreUsuario }}</h2>

    <div *ngIf="cargando" class="loading-container">
        <div class="spinner"></div>
        <p>Calculando tus notas...</p>
    </div>


    <div *ngIf="!cargando && stats" class="animate-fade-in">
        <div class="kpi-container">
            <div class="card-kpi green">
                <h3>ğŸ† Aprobadas</h3>
                <p class="promedio-valor">{{ stats.Aprobadas }}</p>
            </div>
            <div class="card-kpi red">
                <h3>ğŸ† Suspensas</h3>
                <p class="promedio-valor">{{ stats.Suspensas }}</p>
            </div>
            <div class="card-kpi blue">
                <h3>â­ Nota Media</h3>
                <p class="promedio-valor">{{ stats.PromedioGlobal }}</p>
            </div>
            <div class="card-kpi purple">
                <h3>ğŸ“š Asignaturas</h3>
                <p class="promedio-valor">{{ stats.TotalAsignaturas }}</p>
            </div>
        </div>

        <hr>

        <div class="chart-section">
            <h3>ğŸ“Š Notas por Asignatura</h3>
            <div class="chart-container">
                <ngx-charts-bar-vertical [view]="view" [scheme]="colorScheme" [results]="stats.GraficaNotas"
                    [gradient]="gradient" [xAxis]="showXAxis" [yAxis]="showYAxis" [legend]="showLegend"
                    [showXAxisLabel]="showXAxisLabel" [showYAxisLabel]="showYAxisLabel" [xAxisLabel]="xAxisLabel"
                    [yAxisLabel]="yAxisLabel">
                </ngx-charts-bar-vertical>
            </div>
        </div>
        <div class="card-dashboard">
            <h3>ğŸ“Š Aprobadas, Suspensas, sin calificar</h3>
            <div style="height: 250px;">
                <ngx-charts-pie-chart [scheme]="colorSchemeRatio" [results]="ratioAprobados" [gradient]="true"
                    [legend]="true" [labels]="false" [doughnut]="true">
                </ngx-charts-pie-chart>
            </div>
        </div>
        <hr>
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div class="card-dashboard" style="flex: 1; min-width: 300px;">
                <h3>ğŸ“ Mis Calificaciones</h3>
                <div *ngIf="asignaturas.length === 0" class="empty-state">
                    <p>ğŸ‰ Â¡Sin asignaturas!</p>
                </div>
                <table class="tabla-notas" *ngIf="asignaturas.length > 0">
                    <thead>
                        <tr>
                            <th>Asignatura</th>
                            <th>Nota</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let p of asignaturas">
                            <td>{{ p.Clase }}</td>
                            <td>{{ p.Nota }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="card-dashboard" style="flex: 1; min-width: 300px;">
                <h3>ğŸ“ Asignaturas Matriculadas</h3>

                <div *ngIf="asignaturas.length === 0" class="empty-state">
                    <p>ğŸ‰ Â¡Sin asignaturas!</p>
                </div>
                <ul class="lista-simple" *ngIf="asignaturas.length > 0">
                    <li *ngFor="let p of asignaturas">
                        <span>{{ p.Nombre }}</span>
                        <small style="color: #666;">Prof: {{ p.Profesor }}</small>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>