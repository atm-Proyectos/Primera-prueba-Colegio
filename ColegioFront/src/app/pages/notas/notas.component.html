<div class="dashboard-panel">
  <h2>ğŸ“ GestiÃ³n de Notas</h2>

  <div *ngIf="mensajeError" class="alerta-error">
    {{ mensajeError }}
  </div>

  <form #formNotas="ngForm" (ngSubmit)="guardar()">
    <div class="filtros-dashboard" style="align-items: flex-start;">

      <div style="flex: 1;">
        <select [(ngModel)]="formSeleccion.alumnoId" name="alumnoId" required style="width: 100%;"
          (change)="alCambiarAlumno()">
          <option [ngValue]="null">-- 1. Selecciona Alumno --</option>
          <option *ngFor="let alu of listaAlumnos" [ngValue]="alu.id">
            {{ alu.nombre }} {{ alu.apellido }}
          </option>
        </select>
      </div>

      <div style="flex: 1;">
        <select [(ngModel)]="formSeleccion.asignaturaId" name="asignaturaId" required style="width: 100%;"
          [disabled]="!formSeleccion.alumnoId">
          <option [ngValue]="null">-- 2. Selecciona Asignatura --</option>
          <option *ngFor="let asig of listaAsignaturasDelAlumno" [ngValue]="asig.idAsignaturaReal">
            {{ asig.nombreAsignatura }}
          </option>
        </select>
      </div>

      <div style="width: 120px;">
        <input type="number" [(ngModel)]="valorNota" name="valorNota" placeholder="Nota (0-10)" required min="0"
          max="10" #notaInput="ngModel"
          [class.input-error]="notaInput.invalid && (notaInput.dirty || notaInput.touched)" style="width: 100%;">

        <small *ngIf="notaInput.invalid && notaInput.touched" class="msg-error">
          <span *ngIf="notaInput.errors?.['min']">MÃ­nimo 0</span>
          <span *ngIf="notaInput.errors?.['max']">Â¡MÃ¡ximo 10!</span>
        </small>
      </div>

      <div>
        <button type="submit" class="btn-guardar" [disabled]="formNotas.invalid || !formSeleccion.asignaturaId">
          {{ notaIdEditar === 0 ? 'ğŸ’¾ Guardar' : 'ğŸ”„ Actualizar' }}
        </button>

        <button *ngIf="notaIdEditar !== 0" type="button" (click)="limpiar()" class="btn-cancelar">âŒ</button>
      </div>
    </div>
  </form>
</div>

<app-spinner *ngIf="cargando" texto="Cargando boletÃ­n..."></app-spinner>

<table class="tabla-datos" *ngIf="!cargando">
  <thead>
    <tr>
      <th>Alumno</th>
      <th>Asignatura</th>
      <th>Nota</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let nota of listaNotas">
      <td>{{ nota.nombreAlumno }}</td>
      <td>{{ nota.nombreAsignatura }}</td>
      <td [style.color]="nota.valor >= 5 ? 'green' : 'red'" style="font-weight: bold; font-size: 1.1em;">
        {{ nota.valor }}
      </td>

      <td>
        <button (click)="editar(nota)" class="btn-editar">âœï¸</button>
        <button (click)="eliminar(nota.id)" class="btn-borrar">ğŸ—‘ï¸</button>
      </td>
    </tr>
  </tbody>
</table>